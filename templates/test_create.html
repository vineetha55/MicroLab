{% if request.session.b_id%}
{% include 'navbar_branch.html' %}
{% else %}
{% include 'navbar.html' %}
{% endif %}

<div class="container mt-4">
  <h2>Add Diagnostic Test</h2>
  <form method="POST">
    {% csrf_token %}
 <div class="form-group mb-3">
      <label>Select Branch</label><br><div class="form-group mb-3">
      <select class="form-control" name="branch" required>
         {% for branch in branches %}
        <option value="{{branch.id}}">{{branch.name}}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Basic Fields -->
    <div class="form-group mb-3">
      <label for="name">Test Name</label>
      <input type="text" class="form-control" id="name" name="name" required>
    </div>

    <div class="form-group mb-3">
      <label for="description">About the Test</label>
      <textarea class="form-control" id="description" name="description" rows="3" required></textarea>
    </div>

    <div class="form-group mb-3">
      <label for="instructions">Test Preparation</label>
      <textarea class="form-control" id="instructions" name="instructions" rows="2"></textarea>
    </div>

    <div class="form-group mb-3">
      <label for="price">Price (INR)</label>
      <input type="number" class="form-control" id="price" name="price" step="0.01" required>
    </div>

    <div class="form-group mb-3">
      <label for="sample_type">Sample Type</label>
      <input type="text" class="form-control" id="sample_type" name="sample_type" required>
    </div>

    <div class="form-group mb-3">
      <label for="report_time">Report Time</label>
      <input type="text" class="form-control" id="report_time" name="report_time" required>
    </div>

    <!-- Additional Fields -->
    <div class="form-group mb-3">
      <label for="reports_within">Reports Within</label>
      <input type="text" class="form-control" id="reports_within" name="reports_within">
    </div>

    <div class="form-group mb-3">
      <label for="measures">Measures (What the test checks)</label>
      <textarea class="form-control" id="measures" name="measures" rows="2"></textarea>
    </div>

    <div class="form-group mb-3">
      <label for="components">List of Parameters</label>
      <textarea class="form-control" id="components" name="components" rows="2" placeholder="Comma-separated list"></textarea>
    </div>

    <div class="form-group mb-3">
      <label for="purpose">Why This Test</label>
      <textarea class="form-control" id="purpose" name="purpose" rows="2"></textarea>
    </div>

    <div class="form-group mb-3">
      <label for="interpretations">Interpretations</label>
      <textarea class="form-control" id="interpretations" name="interpretations" rows="3"></textarea>
    </div>

    <div class="form-group mb-3">
      <label for="category">Category</label>
      <input type="text" class="form-control" id="category" name="category" placeholder="e.g. Viral, Hormone, Fever">
    </div>


    <!-- FAQ Section -->
    <hr>
    <h5 class="mt-4">Frequently Asked Questions</h5>
    <div id="faq-section"></div>

    <button type="button" class="btn btn-secondary mb-3" onclick="addFAQ()">+ Add FAQ</button>

    <!-- Submit -->
    <div class="form-group mt-3">
      <button type="submit" class="btn btn-success">Create Test</button>
    </div>
  </form>
</div>

<!-- JavaScript for dynamic FAQ fields -->
<script>
  let faqIndex = 0;

  function addFAQ() {
    const faqSection = document.getElementById("faq-section");
    const faqHTML = `
      <div class="card p-3 mb-3">
        <div class="form-group mb-2">
          <label>Question</label>
          <input type="text" class="form-control" name="faq_question_${faqIndex}" required>
        </div>
        <div class="form-group mb-2">
          <label>Answer</label>
          <textarea class="form-control" name="faq_answer_${faqIndex}" rows="2" required></textarea>
        </div>
      </div>
    `;
    faqSection.insertAdjacentHTML("beforeend", faqHTML);
    faqIndex++;
  }
</script>
